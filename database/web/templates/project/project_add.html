{% extends 'layout.html' %}


{% block content %}
<div class="panel panel-default">
    <div class="panel-heading"><span class="glyphicon glyphicon-indent-right" aria-hidden="true"></span> Edit Project Information</div>
        <div class="panel-body">
            <form id="upload-form" method="post" enctype="multipart/form-data" class="form-horizontal"  novalidate>
                {% csrf_token %}
                <div class="col-xs-12">
                    <div class="form-group" style="margin-bottom: 25px;">
                        <label for="file"  class="col-sm-2 control-label">Upload Excel File</label>
                        <div class="col-sm-10">
                            <div class="file-upload-container">
                                <input type="file" id="file" name="file" class="form-control">
                                <button type="submit" id="uploadbtn" class="btn btn-primary">Upload</button>
                            </div>
                        </div>
                       
                    </div>
                </div>
               
            </form>
        </div>
        <div class="panel-body">
        <form id="project-form" method="post"  class="form-horizontal" novalidate>
            {% csrf_token %}
            {% for field in form %}
                <div class="col-xs-12">
                    <div class="form-group" style="margin-bottom: 25px;">
                        <label class="col-sm-2 control-label">{{ field.label }}</label>
                        <div class="col-sm-10" style="position: relative">
                            {{ field }}
                            <br>
                            <span style="color: red;position: absolute;">{{ field.errors.0 }}</span>
                        </div>
                    </div>
                </div>
            {% endfor %}
            <div class="row">
                <div class="form-group">
                    <div class="col-xs-12">
                        <div class="col-sm-offset-6 col-sm-10">
                            <button type="submit" class="btn btn-primary" style="width: 200px;">Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script type="text/javascript">
    $(document).ready(function() {
        $('#upload-form').on('submit', function(e) {
            e.preventDefault();
            var formData = new FormData(this);
            $.ajax({
                url: "{% url 'upload_file_project' %}",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function(data) {
                    // 填充项目表单
                    $('#id_projectName').val(data.projectName);
                    $('#id_program').val(data.program);
                    $('#id_equipment').val(data.equipment);
                    $('#id_customer').val(data.customer);
                    $('#id_projectNo').val(data.projectNo);
                    // $('#id_partsNumber').val(data.partsNumber);
                    $('#id_relativeDesign').val(data.relativeDesign);
                    $('#id_structureDrawingNb').val(data.structureDrawingNb);
                    $('#id_documentNb').val(data.documentNb);
                    $('#id_revision').val(data.revision);
                    $('#id_lastUpdate').val(data.lastUpdate);
                },
                error: function(data) {
                    console.log("An error occurred.");
                }
            });
        });
    });
</script>
{% endblock %}

{% block css %}
<style>
    table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 100px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
    }
    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    th {
        background-color: #4CAF50;
        color: white;
    }
  
    #btnf1, .btnf2{
        width: 100px; 
        background-color: #49b7be; 
        color: white; 
        padding: 5px 10px; 
        margin: 8px;
        margin-right: 0px;
        border: none; 
        border-radius: 4px;
        cursor: pointer; 
    }
    input[type="text"], input[type="number"], #id_valid {
        width: 100%; 
        padding: 8px; 
        margin: 0px 0; 
        display: inline-block;
        border: 1px solid #ccc; 
        border-radius: 4px; 
        box-sizing: border-box; 
    }
    #uploadbtn {
        width: 100px;
        height: 33px;
        font-size: 18px; 
        border: none;
        outline: none; 
        background-color: #4CAF50; 
        color: white;
        cursor: pointer;
        border-radius: 4px; 
    }
    #uploadbtn:hover {
        background-color: #2f7a30; 
    }
    .file-upload-container {
        display: flex;
        align-items: center;
    }
    .file-upload-container input[type="file"] {
        margin-right: 10px;  
    }
    .file-upload-container button {
        white-space: nowrap;
    }
   
</style>
{% endblock %}